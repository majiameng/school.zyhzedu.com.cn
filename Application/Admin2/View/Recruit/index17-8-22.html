<include file="Public:header" />

<style>.move_cat{display:inline-block}</style>

<div id="content">
    <div id="content-header">
		 <h1>
	<neq name="Think.session.admin.role_id" value="1">
       您好!<b>{$Think.session.admin.city_name}用户</b>,
	</neq>	
		欢迎访问石家庄工程职业学院聘用制员工招聘报名审核系统
		</h1>
    </div>
    <div class="condition">
        <div class="well condi-1">
            <H5 class="condi-P">审核状态:</H5>
            <ul>
                <li <eq name="status" value="2">class="pup"</eq>><a href="{:U('Recruit/index','status=2')}">待审核({$result[2]})</a></li>
                <li <eq name="status" value="3">class="pup"</eq>><a href="{:U('Recruit/index','status=3')}">未通过({$result[3]})</a></li>
                <li <eq name="status" value="4">class="pup"</eq>><a href="{:U('Recruit/index','status=4')}">资料待完善({$result[4]})</a></li>
                <li <eq name="status" value="1">class="pup"</eq>><a href="{:U('Recruit/index','status=1')}">审核通过({$result[1]})</a></li>
                <li <eq name="status" value="0">class="pup"</eq>><a href="{:U('Recruit/index','status=0')}">全部({$result|array_sum})</a></li>
            </ul>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
            
            	<form class="well form-search" method="get" action="__ACTION__" id="searchform">
					<input type="hidden" name="status" value="{$status}">
					<span>报考科室：
						<select name="unit" id="recurit_unit" data-select="{$Think.get.unit}" style="width:140px;">
							<option value='0'>请选择</option>
							<foreach name="unit" item="r" key="k">
							<option value='{$k}' <if condition=" $k eq $Think.get.unit ">selected</if>>{$r.name}</option>
							</foreach>
						</select> &nbsp;报考岗位
                        <select name="job" id="recurit_job" data-select="{$Think.get.job}" style="width:110px;">
							<option value='0'>请选择</option>
						</select> &nbsp;
						出生日期：
						<input type="text" name="start_time" value="{$formget.start_time}" style="width: 70px;" onclick="WdatePicker({dateFmt:'yyyy.MM.dd'})"> -
						<input type="text" name="end_time" value="{$formget.end_time}" style="width:70px;" onclick="WdatePicker({dateFmt:'yyyy.MM.dd'})"> &nbsp; &nbsp;
						性别：<select name="sex" style="width:65px;">
								<option value="">不限</option>
								<option value="1" <eq name="Think.get.sex" value="1">selected</eq>>男</option>
								<option value="2" <eq name="Think.get.sex" value="2">selected</eq>>女</option>
								</select>
						&nbsp;
						学历：<select name="education" style="width:100px;">
								<option value="0" >不限</option>
								<foreach name="education" item="r" key="k">
								<option value="{$k}" <if condition=" $k eq $Think.get.education ">selected</if>>{$r}</option>
								</foreach>
								</select>
						关键字： 
						<input type="text" name="keyword" style="width: 90px;" value="{$formget.keyword}" placeholder="请输入关键字...">
						<input type="submit" class="btn btn-primary" value="搜索" />
						<input type="submit" name="do" class="btn btn-primary" value="导出" />
					</span>						
				</form>
                <div class="widget-box">
                <form action="{:U('Article/listorders')}" method="post">
                    <div class="widget-title">
						<span class="icon">
							<input type="checkbox" id="title-checkbox" name="title-checkbox" />
						</span>
                        <h5 class="pull-left">应聘人员列表&nbsp;&nbsp;&nbsp;
						<eq name="status" value="2">
						(<span class="required">*</span>代表完善资料)
						</eq>
						</h5>
                    </div>
                    
                    <div class="widget-content nopadding">
                        <table class="table table-bordered table-striped with-check">
                            <thead>
                            <tr>
                                <th><i class="icon-resize-vertical"></i></th>
                                <th>编号</th>
                                <th>姓名</th>
                                <th>性别</th>
                                <th>头像</th>								
                                <th>出生年月</th>								
                                <th>手机</th>								
                                <th>邮箱</th>	
							<lt name="status" value="2">								
                                <th>准考证号</th>
							</lt>	
							<eq name="status" value="0">
								<th>状态</th>
							</eq>
                                <th>毕业院校</th>
                                <th>学历</th>
                                <th>专业</th>
                                <th>报考科室</th>
                                <th>报考岗位</th>								
                                <th>报名时间</th>
                                
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
							<?php 
							$page = isset($_GET['p'])?intval($_GET['p']):1;
							$m = 1+($page-1)*20
							?>
                            <volist name="list" id="vo">							
						
                                <tr>                          
                                <td><input type="checkbox" name="ids[]" value="{$vo.id}" title="ID:{$vo.id}"/></td> 
                                <td>{$m}</td> 								
                                <td>								
								<if condition=" $vo.status eq 2 and $vo.is_ok eq 1 and in_array($status,array(0,2))">
								<span class="required">*</span>
								</if>								
								{$vo.name}</td>
                                <td>{$sex[$vo[sex]]}</td>
                                <td><a href="javascript:void(0);" data-src="{$vo.avatar}" id="avatar_{$vo.id}">查看</a></td>
								<td>{$vo.birth}</td>
								<td>{$vo.mobile}</td>
								<td>{$vo.email}</td>
								<lt name="status" value="2">
								<td>{$vo.no}</td>
								</lt>
								<eq name="status" value="0">
								<td>{$recuit_status[$vo[status]]}</td>
								</eq>
								<td>{$vo.school}</td>
                                <td>{$education[$vo[education]]}</td>
								<td>{$vo.profession}</td>
                                <td>{$unit[$vo[unit]][name]}</td>
                                <td>{$job[$vo[job]]}</td>
                                <td>{$vo[addtime]|date="Y.m.d H:i",###}</td>                                                       
                                <td class="center">
                                    <a href="javascript:;" id="detail_{$vo.id}">
									<eq name="vo.status" value="2">
									<span class="btn btn-primary btn-mini ">审核</span>
									<else/>
									<span class="btn btn-success btn-mini">详情</span>
									</eq>
									</a>
                                </td>
                                </tr>
									<?php $m++;?>
                            </volist>

                            </tbody>
                        </table>
                    </div>
                    <div class="widget-title">
						<span class="icon">
							<input type="checkbox" id="title-checkbox" name="title-checkbox" />
						</span>  
						 <h5 style="padding-top:5px;">						 
							&nbsp;
							<select id="print-type" name="type" style="width:100px;">
							<option value="0">打印条数</option>
							<option value="100">100条</option>
							<option value="300">300条</option>
							<option value="500">500条</option>
							<option value="800">800条</option>
							<option value="1">全部</option>
							</select>
							
							<a class="btn btn-primary btn-small btn-do" type="submit"  data-href="{:U('Recruit/printdetail')}" href="javascript:;" target="_blank" id="btn-print"/>打印报名表</a>
							&nbsp;&nbsp;
							<a class="btn btn-primary btn-small btn-do" type="submit"  data-href="{:U('Recruit/printlist')}" href="javascript:;" target="_blank" id="btn-print"/>打印准考证</a>
							&nbsp;&nbsp;
							<a class="btn btn-primary btn-small btn-do" type="submit"  data-href="{:U('Recruit/printlist')}" href="javascript:;" target="_blank" id="btn-print"/>批量拒绝</a>
							
							<!-- <a class="btn btn-primary btn-small btn-do" type="submit"  data-href="{:U('Recruit/printcard')}" href="javascript:;" target="_blank" id="btn-print"/>导出PDF</a> -->
							
	                    	</h5>
                    </div>
                    <div class="widget-bottom">
                        <div class="dataTables_filter">
	                        
	                    </div>
                        <div class="dataTables_paginate">
                            {$pages}
                        </div>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="__PUBLIC__/js/recruit_list.js"></script>
<script src="__PUBLIC__/js/recruit.js"></script>
<script>
var web_status = {$status};
function moveto(){
	$('.move_cat').toggle();
}
$(document).ready(function(){
	var ids;
	$('.btn-do').click(function(){
		ids = get_ids();
		var val = $('#print-type').val();

		if(ids.length==0 && val==0){
			layer.msg('请选择信息', {icon: 5});
			return false;
		}		
		var url = $(this).data('href');
		if(url.indexOf('?')!= -1){
			url+='&ids='+ids;
		}else{
			url+='?ids='+ids;
		}
		if($(this).attr('id')=='btn-print'){
			window.open(url,'_blank');  
		}else{
			location.href = $(this).data('href')+'?'+$('#searchform').serialize();
		}				
		return false;
	});
	function get_ids(){
		return $(':checkbox[name="ids[]"]:checked').map(function(){
			return $(this).val();
		}).get();
	}
	$("a[id^=detail_]").click(function(){	
		var target = $(this);
		var id = target.prop('id').replace('detail_','');		
		layer.open({
		  type: 2,
		  closeBtn: true,
		  shadeClose: true,
		  area: ['60%', '90%'],
		  fixed: false, //不固定
		  maxmin: true,
		  btn: ['保存', '直接关闭'],
		  yes: function(index, layero){
			var body = layer.getChildFrame('body', index);
			var obj = body.find(':radio[name="status"]:checked');
			var len = obj.length;
			if(len == 0) {
				layer.msg('请审核',{icon:5});return false;
			}
			var status = obj.val();
			var remark = $.trim(body.find('#remark').val());
			$.post('/index.php/admin2/recruit/detail?id='+id,{remark:remark,status:status},function(json){
				if(json.status==1) {
					if(web_status==0) {
						location.reload();return false;
					}
					if(web_status!=status) {
						target.closest('tr').fadeOut();
					}
					
					layer.closeAll();
					return false;
				}
				layer.msg(json.info,{icon:5});
				return false;
			});
			
		  },
		  btn2: function(){
			layer.closeAll();
		  },
		  content: '/index.php/admin2/recruit/detail?id='+id
		});
	});
	$("a[id^=avatar]").click(function(){
		var src = $(this).data('src');
		layer.open({  
		  type: 1,
		  title: false,
		  closeBtn: true,
		  shade: false,
		  area: '200px',
		  skin: 'layui-layer-nobg', //没有背景色
		  shadeClose: true,
		  content: '<img src="/'+src+'" alt="头像">'
		});
	})
Recruit.bind($('#recurit_unit'),$('#recurit_job'));	
Recruit.childSelect($('#recurit_unit'),$('#recurit_job'));	
})
</script>
<include file="Public:footer" />